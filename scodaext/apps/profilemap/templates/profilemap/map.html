{% extends "iframe.html" %}

{% load md %}
{% load sekizai_tags %}

{% block "content" %}
{% addtoblock "css" %}
<style>
path.country {
    fill: #FFF;
    stroke: #000;
    stroke-width: 0.5px;
    stroke-dasharray: 1,2;
    }
svg {
    background: #CCCCFF;
    }
.person {
    opacity: 0.7;
    }
.person.S {
    fill: #9999FF;
    }

.person.F {
    fill: #FF5555;
    }

.person.L {
    fill: #00CC00;
    }

#image {
    width: 150px;
    display: inline-block;
    }
#info > div {
    display: inline-block;
    }

#location {
    font-style: italic;
    font-size: 0.9em;
    }
#info {
    position: absolute;
    top: 5px;
    left: 5px;
    width: 300px;
    background: rgba(255,255,255,0.7);
    padding: 5px;
    border-radius: 2px;
    visibility: hidden;
    }
</style>    
{% endaddtoblock %}

<div id="map">
</div>
<div id="info">
<img id="image" />
<div>
<h2 id="name"></h2>
<span id="location"></span>
<p id="description">
</p>
</div>

</div>
{% addtoblock "js" %}
<script src="/static/js/d3.v3.min.js" ></script>
<script src="/static/js/topojson.min.js"></script>
<script>
var width=window.innerWidth;
var height=window.innerHeight;
var svg = d3.select("#map").append("svg")
    .attr("width",width)
    .attr("height",height)

var projection = d3.geo.equirectangular()
    .scale(120)
    .translate([width /2, height/2])
    .precision(0.1);

var path = d3.geo.path()
    .projection(projection);

var persons = {{persons|safe}};

d3.json("/static/data/countries.topojson", function(error,world) {
    console.log(world)
    svg.selectAll(".country")
        .data(topojson.feature(world, world.objects.world).features)
        .enter()
        .append("path")
        .attr("d",path)
        .attr("class",function(d) {return "country "+d.id})
        .on("click", function(d) {
            
            });

    svg.selectAll(".person")
        .data(persons)
        .enter()
        .append("circle")
        .attr("transform",function(d) { return "translate("+projection(d.geo)+")" })
        .attr("r",3)
        .attr("class",function(d) { return "person "+ d.status})
        .on("click", function(d) {
            console.log(d.name);
            d3.select("#name").text(d.name);
            d3.select("#location").text(d.location);
            d3.select("#image").attr("src",d.image);
            d3.select("#description").text(d.description);
            d3.select("#info").attr("style","visibility: visible;");
            })
     d3.select("#info").on("click", function() {
        d3.select("#info").attr("style","");
        })
    })
</script>
{% endaddtoblock %}
{% endblock %}
